import{S as s,i as e,s as t,q as n,R as a,r as l,u as r,T as o,d as i,v as c,b as $,x as d,U as u,C as m,D as f,E as g,t as h,c as p,F as v,K as y,z as I,A as E,B as b,L as w,I as D,J as S,bx as _,a3 as A,Y as T,$ as V,ak as C,by as N,bz as H,_ as k,ah as M,ai as L,a1 as O,W as x,an as j,ab as B,b7 as R,bA as G,bB as q,ba as z,av as F,l as U,ac as W,bC as J,bD as K,bE as P,bF as X,bG as Y,o as Q,aU as Z,m as ss,n as es,aJ as ts,bH as ns,a as as,H as ls,bI as rs,g as os,V as is,bJ as cs,bK as $s,bv as ds,bL as us,bM as ms,aA as fs,ax as gs,e as hs}from"./client.b937c12a.js";import{S as ps}from"./Proxy.9d528d01.js";import"./Hotspot.02fef027.js";import"./ContentPanel.40fdf81b.js";import{C as vs}from"./ContentLoader.83142d4b.js";import{L as ys}from"./post_like_selected.c79724df.js";import{S as Is}from"./send.53c7ac4a.js";import{L as Es}from"./Location.3ba33b0a.js";function bs(s){let e,t;return{c(){e=n("div"),t=a(s[3]),this.h()},l(n){e=l(n,"DIV",{class:!0});var a=r(e);t=o(a,s[3]),a.forEach(i),this.h()},h(){c(e,"class","dateHeader svelte-37ndgl")},m(s,n){$(s,e,n),d(e,t)},p(s,e){8&e&&u(t,s[3])},d(s){s&&i(e)}}}function ws(s){let e;const t=new O({props:{user:s[4],onClick:s[10]?s[11]:null,useThumb:!0}});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p(s,e){const n={};16&e&&(n.user=s[4]),1024&e&&(n.onClick=s[10]?s[11]:null),t.$set(n)},i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function Ds(s){let e;const t=new x({props:{className:"likeButton",icon:ys}});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p:y,i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function Ss(s){let e,t,a,o,u,m,f,g,v,y=s[8]&&bs(s),S=!s[5]&&!s[7]&&ws(s),_=s[9]&&Ds();return{c(){e=n("div"),y&&y.c(),t=I(),a=n("div"),S&&S.c(),o=I(),u=n("div"),m=n("div"),f=n("div"),g=I(),_&&_.c(),this.h()},l(s){e=l(s,"DIV",{class:!0});var n=r(e);y&&y.l(n),t=E(n),a=l(n,"DIV",{class:!0});var c=r(a);S&&S.l(c),o=E(c),u=l(c,"DIV",{class:!0});var $=r(u);m=l($,"DIV",{class:!0});var d=r(m);f=l(d,"DIV",{class:!0}),r(f).forEach(i),d.forEach(i),g=E($),_&&_.l($),$.forEach(i),c.forEach(i),n.forEach(i),this.h()},h(){c(f,"class","message svelte-37ndgl"),c(m,"class","detailInnerContent svelte-37ndgl"),c(u,"class","detailContent svelte-37ndgl"),c(a,"class","messageContent svelte-37ndgl"),b(a,"userBreak",s[6]),b(a,"isSelf",s[5]),c(e,"class","messageListItem svelte-37ndgl")},m(n,l){$(n,e,l),y&&y.m(e,null),d(e,t),d(e,a),S&&S.m(a,null),d(a,o),d(a,u),d(u,m),d(m,f),f.innerHTML=s[2],d(u,g),_&&_.m(u,null),v=!0},p(s,[n]){s[8]?y?y.p(s,n):((y=bs(s)).c(),y.m(e,t)):y&&(y.d(1),y=null),s[5]||s[7]?S&&(w(),p(S,1,1,()=>{S=null}),D()):S?(S.p(s,n),160&n&&h(S,1)):((S=ws(s)).c(),h(S,1),S.m(a,o)),(!v||4&n)&&(f.innerHTML=s[2]),s[9]?_?(_.p(s,n),512&n&&h(_,1)):((_=Ds()).c(),h(_,1),_.m(u,null)):_&&(w(),p(_,1,1,()=>{_=null}),D()),64&n&&b(a,"userBreak",s[6]),32&n&&b(a,"isSelf",s[5])},i(s){v||(h(S),h(_),v=!0)},o(s){p(S),p(_),v=!1},d(s){s&&i(e),y&&y.d(),S&&S.d(),_&&_.d()}}}function _s(s,e,t){let n,a,l,r,o,i=y,c=()=>(i(),i=T(B,s=>t(12,n=s)),B),$=y,d=y;S(s,_,s=>t(16,a=s)),S(s,A,s=>t(19,r=s)),s.$$.on_destroy.push(()=>i()),s.$$.on_destroy.push(()=>$()),s.$$.on_destroy.push(()=>d());let u,m,f,g,h,p,v,I,E,b,w,D,O,x,{message:B}=e;return c(),s.$set=(s=>{"message"in s&&c(t(0,B=s.message))}),s.$$.update=(()=>{4096&s.$$.dirty&&(()=>(d(),d=T(u,s=>t(20,o=s)),u))(t(1,u=n&&n.lastMessage||V(null))),4096&s.$$.dirty&&t(2,m=n&&n.message&&C(n.message)||""),4096&s.$$.dirty&&(f=n&&n.id||null),4096&s.$$.dirty&&t(14,g=n&&n.createdAt||null),16384&s.$$.dirty&&t(3,h=g&&N(g)||""),69632&s.$$.dirty&&t(15,p=n&&a&&H(a,n.userId)||null),49152&s.$$.dirty&&(()=>($(),$=T(v,s=>t(18,l=s)),v))(t(4,v=p&&g&&k(p,g)||V(null))),294912&s.$$.dirty&&t(17,I=l&&l.name||p&&p.name||""),557056&s.$$.dirty&&t(5,E=!p||p.id===r),1052672&s.$$.dirty&&t(6,b=o&&n.userId!==o.userId||!1),1052672&s.$$.dirty&&t(7,w=o&&n.userId==o.userId||!1),1052672&s.$$.dirty&&t(8,D=n&&(!o||M(o.createdAt,n.createdAt)>L.DATE_SHOWN_MESSAGE_DATE_DIFF)||!1),4096&s.$$.dirty&&t(9,O=n&&n.likes&&n.likes.length||!1),s.$$.dirty,262144&s.$$.dirty&&t(10,x=l&&l.name||!1)}),[B,u,m,h,v,E,b,w,D,O,x,function(){x&&j(l.id)}]}class As extends s{constructor(s){super(),e(this,s,_s,Ss,t,{message:0})}}function Ts(s,e,t){const n=s.slice();return n[3]=e[t],n}function Vs(s){let e;const t=new As({props:{message:s[3]}});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p(s,e){const n={};4&e&&(n.message=s[3]),t.$set(n)},i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function Cs(s){let e,t,a,o=s[2],d=[];for(let e=0;e<o.length;e+=1)d[e]=Vs(Ts(s,o,e));const u=s=>p(d[s],1,1,()=>{d[s]=null});return{c(){e=n("div");for(let s=0;s<d.length;s+=1)d[s].c();this.h()},l(s){e=l(s,"DIV",{class:!0});var t=r(e);for(let s=0;s<d.length;s+=1)d[s].l(t);t.forEach(i),this.h()},h(){c(e,"class",t="messageList "+s[1]+" svelte-szvkl4")},m(s,t){$(s,e,t);for(let s=0;s<d.length;s+=1)d[s].m(e,null);a=!0},p(s,[n]){if(4&n){let t;for(o=s[2],t=0;t<o.length;t+=1){const a=Ts(s,o,t);d[t]?(d[t].p(a,n),h(d[t],1)):(d[t]=Vs(a),d[t].c(),h(d[t],1),d[t].m(e,null))}for(w(),t=o.length;t<d.length;t+=1)u(t);D()}(!a||2&n&&t!==(t="messageList "+s[1]+" svelte-szvkl4"))&&c(e,"class",t)},i(s){if(!a){for(let s=0;s<o.length;s+=1)h(d[s]);a=!0}},o(s){d=d.filter(Boolean);for(let s=0;s<d.length;s+=1)p(d[s]);a=!1},d(s){s&&i(e),B(d,s)}}}function Ns(s,e,t){let n,a=y,l=()=>(a(),a=T(r,s=>t(2,n=s)),r);s.$$.on_destroy.push(()=>a());let{messages:r}=e;l();let{className:o=""}=e;return s.$set=(s=>{"messages"in s&&l(t(0,r=s.messages)),"className"in s&&t(1,o=s.className)}),[r,o,n]}class Hs extends s{constructor(s){super(),e(this,s,Ns,Cs,t,{messages:0,className:1})}}function ks(s){let e,t,a,o,u,y,b,w;const D=new x({props:{className:"sendButton",disabled:!s[2],onClick:s[3],icon:Is}});return{c(){e=n("div"),t=n("div"),m(D.$$.fragment),a=I(),o=n("div"),u=n("textarea"),this.h()},l(s){e=l(s,"DIV",{class:!0});var n=r(e);t=l(n,"DIV",{class:!0});var c=r(t);f(D.$$.fragment,c),a=E(c),o=l(c,"DIV",{class:!0});var $=r(o);u=l($,"TEXTAREA",{rows:!0,class:!0}),r(u).forEach(i),$.forEach(i),c.forEach(i),n.forEach(i),this.h()},h(){c(u,"rows","1"),c(u,"class","svelte-uhjl0u"),c(o,"class","field svelte-uhjl0u"),c(t,"class","fieldRegion svelte-uhjl0u"),c(e,"class","messageInput svelte-uhjl0u")},m(n,l){$(n,e,l),d(e,t),g(D,t,null),d(t,a),d(t,o),d(o,u),F(u,s[0]),s[13](u),y=!0,b||(w=[U(u,"input",s[12]),U(u,"keypress",s[14])],b=!0)},p(s,[e]){const t={};4&e&&(t.disabled=!s[2]),D.$set(t),1&e&&F(u,s[0])},i(s){y||(h(D.$$.fragment,s),y=!0)},o(s){p(D.$$.fragment,s),y=!1},d(t){t&&i(e),v(D),s[13](null),b=!1,W(w)}}}function Ms(s,e,t){let n,a,l;S(s,J,s=>t(6,n=s)),S(s,K,s=>t(7,a=s)),S(s,P,s=>t(8,l=s));let r,{message:o=""}=e,{image:i=null}=e,c=X(),$=Y();function d(){if(f){const s={id:c,message:Z(o)};n&&!a&&(s.conversationId=n),i&&(s.image=i),a&&(s.newConversation=!0,s.targetUserIds=l,s.conversationId=$),t(0,o=""),c=X(),function(s){if(!R())return;const e=G(s);return e&&e.then(s=>{s&&!s.error&&s.newConversation&&(s.conversation&&q(s.conversation),s.conversationId&&z(s.conversationId,!0,!0))}),e}(s).then(s=>{s&&(s.success||s.addedMessage||s.duplicateKey)})}}function u(){f&&(d(),r&&r.focus())}function m(){(async()=>{if(await ss(),r&&r.style&&"undefined"!=typeof window&&window.getComputedStyle){if(t(1,r.style.height="inherit",r),window.getComputedStyle(r)){const s=r.scrollHeight+4;t(1,r.style.height=s+"px",r)}}})()}Q(()=>{r&&r.focus()});let f;return s.$set=(s=>{"message"in s&&t(0,o=s.message),"image"in s&&t(4,i=s.image)}),s.$$.update=(()=>{209&s.$$.dirty&&t(2,f=(n||a)&&!(!Z(o)&&!i)),1&s.$$.dirty&&m()}),[o,r,f,u,i,c,n,a,l,$,d,m,function(){o=this.value,t(0,o)},function(s){es[s?"unshift":"push"](()=>{t(1,r=s)})},s=>ts(s,{action:u,actionOnCtrl:!0,preventBlur:!0})]}class Ls extends s{constructor(s){super(),e(this,s,Ms,ks,t,{message:0,image:4})}}function Os(s){let e;const t=new Es({props:{location:s[2]}});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p(s,e){const n={};4&e&&(n.location=s[2]),t.$set(n)},i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function xs(s){let e,t,y,b,S,_,A,T,V,C,N,H,k;const M=new O({props:{user:ns,useThumb:!0}});let L=s[2]&&Os(s);return{c(){e=n("div"),t=n("div"),y=n("div"),m(M.$$.fragment),b=I(),S=n("div"),_=a(s[0]),A=I(),T=n("div"),V=a(s[1]),C=I(),L&&L.c(),this.h()},l(n){e=l(n,"DIV",{class:!0});var a=r(e);t=l(a,"DIV",{class:!0});var c=r(t);y=l(c,"DIV",{class:!0});var $=r(y);f(M.$$.fragment,$),b=E($),S=l($,"DIV",{class:!0});var d=r(S);_=o(d,s[0]),d.forEach(i),A=E($),T=l($,"DIV",{class:!0});var u=r(T);V=o(u,s[1]),u.forEach(i),$.forEach(i),C=E(c),L&&L.l(c),c.forEach(i),a.forEach(i),this.h()},h(){c(S,"class","userDisplayName svelte-yn8q53"),c(T,"class","username svelte-yn8q53"),c(y,"class","profileRegion button svelte-yn8q53"),c(t,"class","profileInfo svelte-yn8q53"),c(e,"class","conversationProfile svelte-yn8q53")},m(n,a){$(n,e,a),d(e,t),d(t,y),g(M,y,null),d(y,b),d(y,S),d(S,_),d(y,A),d(y,T),d(T,V),d(t,C),L&&L.m(t,null),N=!0,H||(k=U(y,"click",s[3]),H=!0)},p(s,[e]){(!N||1&e)&&u(_,s[0]),(!N||2&e)&&u(V,s[1]),s[2]?L?(L.p(s,e),4&e&&h(L,1)):((L=Os(s)).c(),h(L,1),L.m(t,null)):L&&(w(),p(L,1,1,()=>{L=null}),D())},i(s){N||(h(M.$$.fragment,s),h(L),N=!0)},o(s){p(M.$$.fragment,s),p(L),N=!1},d(s){s&&i(e),v(M),L&&L.d(),H=!1,k()}}}function js(s,e,t){let n,a,l,r;return S(s,ns,s=>t(4,n=s)),s.$$.update=(()=>{16&s.$$.dirty&&t(0,a=n&&n.name||""),16&s.$$.dirty&&t(1,l=n&&n.username&&"@"+n.username||""),16&s.$$.dirty&&t(2,r=n&&n.location||"")}),[a,l,r,function(){n&&n.id&&j(n.id)}]}class Bs extends s{constructor(s){super(),e(this,s,js,xs,t,{})}}function Rs(s){let e,t;function n(e){s[27].call(null,e)}let a={onScroll:s[10],anchorToBottom:!0,id:"conversation",$$slots:{default:[Us]},$$scope:{ctx:s}};void 0!==s[2]&&(a.scrollRegion=s[2]);const l=new ps({props:a});return es.push(()=>fs(l,"scrollRegion",n)),{c(){m(l.$$.fragment)},l(s){f(l.$$.fragment,s)},m(s,e){g(l,s,e),t=!0},p(s,t){const n={};268435617&t&&(n.$$scope={dirty:t,ctx:s}),!e&&4&t&&(e=!0,n.scrollRegion=s[2],gs(()=>e=!1)),l.$set(n)},i(s){t||(h(l.$$.fragment,s),t=!0)},o(s){p(l.$$.fragment,s),t=!1},d(s){v(l,s)}}}function Gs(s){let e;const t=new vs({props:{label:is.CONVERSATION.NO_MESSAGES}});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p:y,i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function qs(s){let e;const t=new vs({props:{label:is.LOADING.MESSAGES}});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p:y,i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function zs(s){let e;const t=new Hs({props:{messages:s[0]}});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p(s,e){const n={};1&e&&(n.messages=s[0]),t.$set(n)},i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function Fs(s){let e;const t=new Bs({});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},p:y,i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function Us(s){let e,t,n,a;const l=[Fs,zs],r=[];function o(s,e){return s[7]?0:s[5]?1:-1}return~(e=o(s))&&(t=r[e]=l[e](s)),{c(){t&&t.c(),n=hs()},l(s){t&&t.l(s),n=hs()},m(s,t){~e&&r[e].m(s,t),$(s,n,t),a=!0},p(s,a){let i=e;(e=o(s))===i?~e&&r[e].p(s,a):(t&&(w(),p(r[i],1,1,()=>{r[i]=null}),D()),~e?((t=r[e])||(t=r[e]=l[e](s)).c(),h(t,1),t.m(n.parentNode,n)):t=null)},i(s){a||(h(t),a=!0)},o(s){p(t),a=!1},d(s){~e&&r[e].d(s),s&&i(n)}}}function Ws(s){let e,t,u,m,f,g=is.CONVERSATION.MESSAGES_ADDED+"";return{c(){e=n("div"),t=n("div"),u=a(g),this.h()},l(s){e=l(s,"DIV",{class:!0});var n=r(e);t=l(n,"DIV",{class:!0});var a=r(t);u=o(a,g),a.forEach(i),n.forEach(i),this.h()},h(){c(t,"class","messagesAddedIndicator button svelte-ed6b4u"),c(e,"class","messagesAddedIndicatorContainer svelte-ed6b4u")},m(n,a){$(n,e,a),d(e,t),d(t,u),m||(f=U(t,"click",s[9]),m=!0)},p:y,d(s){s&&i(e),m=!1,f()}}}function Js(s){let e;const t=new Ls({});return{c(){m(t.$$.fragment)},l(s){f(t.$$.fragment,s)},m(s,n){g(t,s,n),e=!0},i(s){e||(h(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){v(t,s)}}}function Ks(s){let e,t,a,o,u,m,f,g,v,y;as(s[26]);const S=[qs,Gs,Rs],_=[];function A(s,e){return s[6]?0:s[5]&&s[5].length||s[7]?2:1}o=A(s),u=_[o]=S[o](s);let T=s[1]&&Ws(s),V=s[8]&&Js();return{c(){e=I(),t=n("div"),a=n("div"),u.c(),m=I(),T&&T.c(),f=I(),V&&V.c(),this.h()},l(s){ls('[data-svelte="svelte-1y4v7mn"]',document.head).forEach(i),e=E(s),t=l(s,"DIV",{class:!0});var n=r(t);a=l(n,"DIV",{class:!0});var o=r(a);u.l(o),m=E(o),T&&T.l(o),o.forEach(i),f=E(n),V&&V.l(n),n.forEach(i),this.h()},h(){document.title="Flock",c(a,"class","messagesView svelte-ed6b4u"),b(a,"newConversation",s[7]),c(t,"class","content svelte-ed6b4u")},m(n,l){$(n,e,l),$(n,t,l),d(t,a),_[o].m(a,null),d(a,m),T&&T.m(a,null),d(t,f),V&&V.m(t,null),g=!0,v||(y=U(window,"resize",s[26]),v=!0)},p(s,[e]){let n=o;(o=A(s))===n?_[o].p(s,e):(w(),p(_[n],1,1,()=>{_[n]=null}),D(),(u=_[o])||(u=_[o]=S[o](s)).c(),h(u,1),u.m(a,m)),s[1]?T?T.p(s,e):((T=Ws(s)).c(),T.m(a,null)):T&&(T.d(1),T=null),128&e&&b(a,"newConversation",s[7]),s[8]?V?256&e&&h(V,1):((V=Js()).c(),h(V,1),V.m(t,null)):V&&(w(),p(V,1,1,()=>{V=null}),D())},i(s){g||(h(u),h(V),g=!0)},o(s){p(u),p(V),g=!1},d(s){s&&i(e),s&&i(t),_[o].d(),T&&T.d(),V&&V.d(),v=!1,y()}}}function Ps(s,e,t){let n,a,l,r,o,i,c,$,d=y,u=()=>(d(),d=T(f,s=>t(5,o=s)),f);S(s,_,s=>t(14,n=s)),S(s,A,s=>t(15,a=s)),S(s,cs,s=>t(16,l=s)),S(s,J,s=>t(17,r=s)),S(s,$s,s=>t(19,i=s)),S(s,ds,s=>t(21,c=s)),S(s,K,s=>t(7,$=s)),s.$$.on_destroy.push(()=>d()),rs();let m=0,{messages:f=V(null)}=e;function g(){u(t(0,f=n&&us({conversationId:r},null,n.isNew)||f))}u();let h,p,v,I=!1,E=0;async function b(){h&&(await ss(),h&&h.scrollTo(0,h.scrollHeight))}async function w(){h&&o&&o.length>m&&(h.scrollTop+h.offsetHeight>h.scrollHeight-L.MIN_AUTO_SCROLL_BOTTOM_DIST?(await ss(),h.scrollTo(0,h.scrollHeight)):t(1,I=!0)),m=o?o.length:0}let D,C,N,H,k,M,O=!1;return Q(()=>{O=!0,ms.on("messagedAdded",b)}),os(()=>{O=!1,ms.off("messagedAdded",b)}),s.$set=(s=>{"messages"in s&&u(t(0,f=s.messages))}),s.$$.update=(()=>{16384&s.$$.dirty&&g(),98304&s.$$.dirty&&rs(),32&s.$$.dirty&&w(),524320&s.$$.dirty&&t(18,D=i&&!o),2244608&s.$$.dirty&&t(20,C=c&&(!n||n.id!==r)),1310848&s.$$.dirty&&t(6,N=(D||C)&&!$),49344&s.$$.dirty&&t(8,H=!N&&a&&(n||$)),16384&s.$$.dirty&&t(22,k=n&&n.isGroup||!1),4194304&s.$$.dirty&&(M=k?"messages_group_view":"message_view"),4120&s.$$.dirty&&(p&&v<L.MOBILE_DEVICE_MAX_WIDTH&&p<E&&(b(),(async()=>{await ss(),b()})()),t(12,E=p))}),[f,I,h,p,v,o,N,$,H,b,function(){I&&h.scrollTop+h.offsetHeight>h.scrollHeight-L.MIN_HIDE_MESSAGES_BOTTOM_DIST&&t(1,I=!1)},m,E,O,n,a,l,r,D,i,C,c,k,M,g,w,function(){t(3,p=window.innerHeight),t(4,v=window.innerWidth)},function(s){t(2,h=s)}]}export default class extends s{constructor(s){super(),e(this,s,Ps,Ks,t,{messages:0})}}
