import{S as e,i as s,s as t,q as n,R as a,r as l,u as r,T as o,d as c,v as i,b as $,x as u,U as d,C as m,D as f,E as g,t as h,c as p,F as v,K as y,z as I,A as E,B as w,L as b,I as D,J as S,b9 as _,a3 as T,Y as V,$ as k,ak as A,ba as C,bb as N,_ as x,ah as H,ai as M,a1 as L,W as O,an as j,ab as B,aE as R,bc as G,bd as q,aI as z,aK as F,l as W,ac as K,be as P,bf as U,bg as X,bh as J,bi as Y,o as Q,bj as Z,m as ee,n as se,aL as te,bk as ne,a as ae,H as le,bl as re,g as oe,V as ce,bm as ie,bn as $e,b7 as ue,bo as de,bp as me,aM as fe,aN as ge,e as he}from"./client.bfcc6923.js";import{S as pe}from"./Proxy.ed17349e.js";import"./Hotspot.3e24c739.js";import"./ContentPanel.e03e13b8.js";import{C as ve}from"./ContentLoader.7e990154.js";import{L as ye}from"./post_like_selected.c79724df.js";import{S as Ie}from"./send.53c7ac4a.js";import{L as Ee}from"./Location.eac922ea.js";function we(e){let s,t;return{c(){s=n("div"),t=a(e[3]),this.h()},l(n){s=l(n,"DIV",{class:!0});var a=r(s);t=o(a,e[3]),a.forEach(c),this.h()},h(){i(s,"class","dateHeader svelte-1oxr1ak")},m(e,n){$(e,s,n),u(s,t)},p(e,s){8&s&&d(t,e[3])},d(e){e&&c(s)}}}function be(e){let s;const t=new L({props:{user:e[4],onClick:e[10]?e[11]:null,useThumb:!0}});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p(e,s){const n={};16&s&&(n.user=e[4]),1024&s&&(n.onClick=e[10]?e[11]:null),t.$set(n)},i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function De(e){let s;const t=new O({props:{className:"likeButton",icon:ye}});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p:y,i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function Se(e){let s,t,a,o,d,m,f,g,v,y=e[8]&&we(e),S=!e[5]&&!e[7]&&be(e),_=e[9]&&De();return{c(){s=n("div"),y&&y.c(),t=I(),a=n("div"),S&&S.c(),o=I(),d=n("div"),m=n("div"),f=n("div"),g=I(),_&&_.c(),this.h()},l(e){s=l(e,"DIV",{class:!0});var n=r(s);y&&y.l(n),t=E(n),a=l(n,"DIV",{class:!0});var i=r(a);S&&S.l(i),o=E(i),d=l(i,"DIV",{class:!0});var $=r(d);m=l($,"DIV",{class:!0});var u=r(m);f=l(u,"DIV",{class:!0}),r(f).forEach(c),u.forEach(c),g=E($),_&&_.l($),$.forEach(c),i.forEach(c),n.forEach(c),this.h()},h(){i(f,"class","message svelte-1oxr1ak"),i(m,"class","detailInnerContent svelte-1oxr1ak"),i(d,"class","detailContent svelte-1oxr1ak"),i(a,"class","messageContent svelte-1oxr1ak"),w(a,"userBreak",e[6]),w(a,"isSelf",e[5]),i(s,"class","messageListItem svelte-1oxr1ak")},m(n,l){$(n,s,l),y&&y.m(s,null),u(s,t),u(s,a),S&&S.m(a,null),u(a,o),u(a,d),u(d,m),u(m,f),f.innerHTML=e[2],u(d,g),_&&_.m(d,null),v=!0},p(e,[n]){e[8]?y?y.p(e,n):((y=we(e)).c(),y.m(s,t)):y&&(y.d(1),y=null),e[5]||e[7]?S&&(b(),p(S,1,1,()=>{S=null}),D()):S?(S.p(e,n),160&n&&h(S,1)):((S=be(e)).c(),h(S,1),S.m(a,o)),(!v||4&n)&&(f.innerHTML=e[2]),e[9]?_?(_.p(e,n),512&n&&h(_,1)):((_=De()).c(),h(_,1),_.m(d,null)):_&&(b(),p(_,1,1,()=>{_=null}),D()),64&n&&w(a,"userBreak",e[6]),32&n&&w(a,"isSelf",e[5])},i(e){v||(h(S),h(_),v=!0)},o(e){p(S),p(_),v=!1},d(e){e&&c(s),y&&y.d(),S&&S.d(),_&&_.d()}}}function _e(e,s,t){let n,a,l,r,o,c=y,i=()=>(c(),c=V(B,e=>t(12,n=e)),B),$=y,u=y;S(e,_,e=>t(16,a=e)),S(e,T,e=>t(19,r=e)),e.$$.on_destroy.push(()=>c()),e.$$.on_destroy.push(()=>$()),e.$$.on_destroy.push(()=>u());let d,m,f,g,h,p,v,I,E,w,b,D,L,O,{message:B}=s;return i(),e.$set=(e=>{"message"in e&&i(t(0,B=e.message))}),e.$$.update=(()=>{4096&e.$$.dirty&&(()=>(u(),u=V(d,e=>t(20,o=e)),d))(t(1,d=n&&n.lastMessage||k(null))),4096&e.$$.dirty&&t(2,m=n&&n.message&&A(n.message)||""),4096&e.$$.dirty&&(f=n&&n.id||null),4096&e.$$.dirty&&t(14,g=n&&n.createdAt||null),16384&e.$$.dirty&&t(3,h=g&&C(g)||""),69632&e.$$.dirty&&t(15,p=n&&a&&N(a,n.userId)||null),49152&e.$$.dirty&&(()=>($(),$=V(v,e=>t(18,l=e)),v))(t(4,v=p&&g&&x(p,g)||k(null))),294912&e.$$.dirty&&t(17,I=l&&l.name||p&&p.name||""),557056&e.$$.dirty&&t(5,E=!p||p.id===r),1052672&e.$$.dirty&&t(6,w=o&&n.userId!==o.userId||!1),1052672&e.$$.dirty&&t(7,b=o&&n.userId==o.userId||!1),1052672&e.$$.dirty&&t(8,D=n&&(!o||H(o.createdAt,n.createdAt)>M.DATE_SHOWN_MESSAGE_DATE_DIFF)||!1),4096&e.$$.dirty&&t(9,L=n&&n.likes&&n.likes.length||!1),e.$$.dirty,262144&e.$$.dirty&&t(10,O=l&&l.name||!1)}),[B,d,m,h,v,E,w,b,D,L,O,function(){O&&j(l.id)}]}class Te extends e{constructor(e){super(),s(this,e,_e,Se,t,{message:0})}}function Ve(e,s,t){const n=e.slice();return n[3]=s[t],n}function ke(e){let s;const t=new Te({props:{message:e[3]}});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p(e,s){const n={};4&s&&(n.message=e[3]),t.$set(n)},i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function Ae(e){let s,t,a,o=e[2],u=[];for(let s=0;s<o.length;s+=1)u[s]=ke(Ve(e,o,s));const d=e=>p(u[e],1,1,()=>{u[e]=null});return{c(){s=n("div");for(let e=0;e<u.length;e+=1)u[e].c();this.h()},l(e){s=l(e,"DIV",{class:!0});var t=r(s);for(let e=0;e<u.length;e+=1)u[e].l(t);t.forEach(c),this.h()},h(){i(s,"class",t="messageList "+e[1]+" svelte-szvkl4")},m(e,t){$(e,s,t);for(let e=0;e<u.length;e+=1)u[e].m(s,null);a=!0},p(e,[n]){if(4&n){let t;for(o=e[2],t=0;t<o.length;t+=1){const a=Ve(e,o,t);u[t]?(u[t].p(a,n),h(u[t],1)):(u[t]=ke(a),u[t].c(),h(u[t],1),u[t].m(s,null))}for(b(),t=o.length;t<u.length;t+=1)d(t);D()}(!a||2&n&&t!==(t="messageList "+e[1]+" svelte-szvkl4"))&&i(s,"class",t)},i(e){if(!a){for(let e=0;e<o.length;e+=1)h(u[e]);a=!0}},o(e){u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)p(u[e]);a=!1},d(e){e&&c(s),B(u,e)}}}function Ce(e,s,t){let n,a=y,l=()=>(a(),a=V(r,e=>t(2,n=e)),r);e.$$.on_destroy.push(()=>a());let{messages:r}=s;l();let{className:o=""}=s;return e.$set=(e=>{"messages"in e&&l(t(0,r=e.messages)),"className"in e&&t(1,o=e.className)}),[r,o,n]}class Ne extends e{constructor(e){super(),s(this,e,Ce,Ae,t,{messages:0,className:1})}}function xe(e){let s,t,a,o,d,y,w,b;const D=new O({props:{className:"sendButton",disabled:!e[2],onClick:e[3],icon:Ie}});return{c(){s=n("div"),t=n("div"),m(D.$$.fragment),a=I(),o=n("div"),d=n("textarea"),this.h()},l(e){s=l(e,"DIV",{class:!0});var n=r(s);t=l(n,"DIV",{class:!0});var i=r(t);f(D.$$.fragment,i),a=E(i),o=l(i,"DIV",{class:!0});var $=r(o);d=l($,"TEXTAREA",{rows:!0,class:!0}),r(d).forEach(c),$.forEach(c),i.forEach(c),n.forEach(c),this.h()},h(){i(d,"rows","1"),i(d,"class","svelte-uhjl0u"),i(o,"class","field svelte-uhjl0u"),i(t,"class","fieldRegion svelte-uhjl0u"),i(s,"class","messageInput svelte-uhjl0u")},m(n,l){$(n,s,l),u(s,t),g(D,t,null),u(t,a),u(t,o),u(o,d),F(d,e[0]),e[13](d),y=!0,w||(b=[W(d,"input",e[12]),W(d,"keypress",e[14])],w=!0)},p(e,[s]){const t={};4&s&&(t.disabled=!e[2]),D.$set(t),1&s&&F(d,e[0])},i(e){y||(h(D.$$.fragment,e),y=!0)},o(e){p(D.$$.fragment,e),y=!1},d(t){t&&c(s),v(D),e[13](null),w=!1,K(b)}}}function He(e,s,t){let n,a,l;S(e,P,e=>t(6,n=e)),S(e,U,e=>t(7,a=e)),S(e,X,e=>t(8,l=e));let r,{message:o=""}=s,{image:c=null}=s,i=J(),$=Y();function u(){if(f){const e={id:i,message:Z(o)};n&&!a&&(e.conversationId=n),c&&(e.image=c),a&&(e.newConversation=!0,e.targetUserIds=l,e.conversationId=$),t(0,o=""),i=J(),function(e){if(!R())return;const s=G(e);return s.then(e=>{e&&!e.error&&e.newConversation&&(e.conversation&&q(e.conversation),e.conversationId&&z(e.conversationId,!0,!0))}),s}(e).then(e=>{e&&(e.success||e.addedMessage||e.duplicateKey)})}}function d(){f&&(u(),r&&r.focus())}function m(){(async()=>{if(await ee(),r&&r.style&&"undefined"!=typeof window&&window.getComputedStyle){if(t(1,r.style.height="inherit",r),window.getComputedStyle(r)){const e=r.scrollHeight+4;t(1,r.style.height=e+"px",r)}}})()}Q(()=>{r&&r.focus()});let f;return e.$set=(e=>{"message"in e&&t(0,o=e.message),"image"in e&&t(4,c=e.image)}),e.$$.update=(()=>{209&e.$$.dirty&&t(2,f=(n||a)&&!(!Z(o)&&!c)),1&e.$$.dirty&&m()}),[o,r,f,d,c,i,n,a,l,$,u,m,function(){o=this.value,t(0,o)},function(e){se[e?"unshift":"push"](()=>{t(1,r=e)})},e=>te(e,{action:d,actionOnCtrl:!0,preventBlur:!0})]}class Me extends e{constructor(e){super(),s(this,e,He,xe,t,{message:0,image:4})}}function Le(e){let s;const t=new Ee({props:{location:e[2]}});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p(e,s){const n={};4&s&&(n.location=e[2]),t.$set(n)},i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function Oe(e){let s,t,y,w,S,_,T,V,k,A,C,N,x;const H=new L({props:{user:ne,useThumb:!0}});let M=e[2]&&Le(e);return{c(){s=n("div"),t=n("div"),y=n("div"),m(H.$$.fragment),w=I(),S=n("div"),_=a(e[0]),T=I(),V=n("div"),k=a(e[1]),A=I(),M&&M.c(),this.h()},l(n){s=l(n,"DIV",{class:!0});var a=r(s);t=l(a,"DIV",{class:!0});var i=r(t);y=l(i,"DIV",{class:!0});var $=r(y);f(H.$$.fragment,$),w=E($),S=l($,"DIV",{class:!0});var u=r(S);_=o(u,e[0]),u.forEach(c),T=E($),V=l($,"DIV",{class:!0});var d=r(V);k=o(d,e[1]),d.forEach(c),$.forEach(c),A=E(i),M&&M.l(i),i.forEach(c),a.forEach(c),this.h()},h(){i(S,"class","userDisplayName svelte-yn8q53"),i(V,"class","username svelte-yn8q53"),i(y,"class","profileRegion button svelte-yn8q53"),i(t,"class","profileInfo svelte-yn8q53"),i(s,"class","conversationProfile svelte-yn8q53")},m(n,a){$(n,s,a),u(s,t),u(t,y),g(H,y,null),u(y,w),u(y,S),u(S,_),u(y,T),u(y,V),u(V,k),u(t,A),M&&M.m(t,null),C=!0,N||(x=W(y,"click",e[3]),N=!0)},p(e,[s]){(!C||1&s)&&d(_,e[0]),(!C||2&s)&&d(k,e[1]),e[2]?M?(M.p(e,s),4&s&&h(M,1)):((M=Le(e)).c(),h(M,1),M.m(t,null)):M&&(b(),p(M,1,1,()=>{M=null}),D())},i(e){C||(h(H.$$.fragment,e),h(M),C=!0)},o(e){p(H.$$.fragment,e),p(M),C=!1},d(e){e&&c(s),v(H),M&&M.d(),N=!1,x()}}}function je(e,s,t){let n,a,l,r;return S(e,ne,e=>t(4,n=e)),e.$$.update=(()=>{16&e.$$.dirty&&t(0,a=n&&n.name||""),16&e.$$.dirty&&t(1,l=n&&n.username&&"@"+n.username||""),16&e.$$.dirty&&t(2,r=n&&n.location||"")}),[a,l,r,function(){n&&n.id&&j(n.id)}]}class Be extends e{constructor(e){super(),s(this,e,je,Oe,t,{})}}function Re(e){let s,t;function n(s){e[27].call(null,s)}let a={onScroll:e[10],anchorToBottom:!0,id:"conversation",$$slots:{default:[We]},$$scope:{ctx:e}};void 0!==e[2]&&(a.scrollRegion=e[2]);const l=new pe({props:a});return se.push(()=>fe(l,"scrollRegion",n)),{c(){m(l.$$.fragment)},l(e){f(l.$$.fragment,e)},m(e,s){g(l,e,s),t=!0},p(e,t){const n={};268435617&t&&(n.$$scope={dirty:t,ctx:e}),!s&&4&t&&(s=!0,n.scrollRegion=e[2],ge(()=>s=!1)),l.$set(n)},i(e){t||(h(l.$$.fragment,e),t=!0)},o(e){p(l.$$.fragment,e),t=!1},d(e){v(l,e)}}}function Ge(e){let s;const t=new ve({props:{label:ce.CONVERSATION.NO_MESSAGES}});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p:y,i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function qe(e){let s;const t=new ve({props:{label:ce.LOADING.MESSAGES}});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p:y,i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function ze(e){let s;const t=new Ne({props:{messages:e[0]}});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p(e,s){const n={};1&s&&(n.messages=e[0]),t.$set(n)},i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function Fe(e){let s;const t=new Be({});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},p:y,i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function We(e){let s,t,n,a;const l=[Fe,ze],r=[];function o(e,s){return e[7]?0:e[5]?1:-1}return~(s=o(e))&&(t=r[s]=l[s](e)),{c(){t&&t.c(),n=he()},l(e){t&&t.l(e),n=he()},m(e,t){~s&&r[s].m(e,t),$(e,n,t),a=!0},p(e,a){let c=s;(s=o(e))===c?~s&&r[s].p(e,a):(t&&(b(),p(r[c],1,1,()=>{r[c]=null}),D()),~s?((t=r[s])||(t=r[s]=l[s](e)).c(),h(t,1),t.m(n.parentNode,n)):t=null)},i(e){a||(h(t),a=!0)},o(e){p(t),a=!1},d(e){~s&&r[s].d(e),e&&c(n)}}}function Ke(e){let s,t,d,m,f,g=ce.CONVERSATION.MESSAGES_ADDED+"";return{c(){s=n("div"),t=n("div"),d=a(g),this.h()},l(e){s=l(e,"DIV",{class:!0});var n=r(s);t=l(n,"DIV",{class:!0});var a=r(t);d=o(a,g),a.forEach(c),n.forEach(c),this.h()},h(){i(t,"class","messagesAddedIndicator button svelte-ed6b4u"),i(s,"class","messagesAddedIndicatorContainer svelte-ed6b4u")},m(n,a){$(n,s,a),u(s,t),u(t,d),m||(f=W(t,"click",e[9]),m=!0)},p:y,d(e){e&&c(s),m=!1,f()}}}function Pe(e){let s;const t=new Me({});return{c(){m(t.$$.fragment)},l(e){f(t.$$.fragment,e)},m(e,n){g(t,e,n),s=!0},i(e){s||(h(t.$$.fragment,e),s=!0)},o(e){p(t.$$.fragment,e),s=!1},d(e){v(t,e)}}}function Ue(e){let s,t,a,o,d,m,f,g,v,y;ae(e[26]);const S=[qe,Ge,Re],_=[];function T(e,s){return e[6]?0:e[5]&&e[5].length||e[7]?2:1}o=T(e),d=_[o]=S[o](e);let V=e[1]&&Ke(e),k=e[8]&&Pe();return{c(){s=I(),t=n("div"),a=n("div"),d.c(),m=I(),V&&V.c(),f=I(),k&&k.c(),this.h()},l(e){le('[data-svelte="svelte-1y4v7mn"]',document.head).forEach(c),s=E(e),t=l(e,"DIV",{class:!0});var n=r(t);a=l(n,"DIV",{class:!0});var o=r(a);d.l(o),m=E(o),V&&V.l(o),o.forEach(c),f=E(n),k&&k.l(n),n.forEach(c),this.h()},h(){document.title="Flock",i(a,"class","messagesView svelte-ed6b4u"),w(a,"newConversation",e[7]),i(t,"class","content svelte-ed6b4u")},m(n,l){$(n,s,l),$(n,t,l),u(t,a),_[o].m(a,null),u(a,m),V&&V.m(a,null),u(t,f),k&&k.m(t,null),g=!0,v||(y=W(window,"resize",e[26]),v=!0)},p(e,[s]){let n=o;(o=T(e))===n?_[o].p(e,s):(b(),p(_[n],1,1,()=>{_[n]=null}),D(),(d=_[o])||(d=_[o]=S[o](e)).c(),h(d,1),d.m(a,m)),e[1]?V?V.p(e,s):((V=Ke(e)).c(),V.m(a,null)):V&&(V.d(1),V=null),128&s&&w(a,"newConversation",e[7]),e[8]?k?256&s&&h(k,1):((k=Pe()).c(),h(k,1),k.m(t,null)):k&&(b(),p(k,1,1,()=>{k=null}),D())},i(e){g||(h(d),h(k),g=!0)},o(e){p(d),p(k),g=!1},d(e){e&&c(s),e&&c(t),_[o].d(),V&&V.d(),k&&k.d(),v=!1,y()}}}function Xe(e,s,t){let n,a,l,r,o,c,i,$,u=y,d=()=>(u(),u=V(f,e=>t(5,o=e)),f);S(e,_,e=>t(14,n=e)),S(e,T,e=>t(15,a=e)),S(e,ie,e=>t(16,l=e)),S(e,P,e=>t(17,r=e)),S(e,$e,e=>t(19,c=e)),S(e,ue,e=>t(21,i=e)),S(e,U,e=>t(7,$=e)),e.$$.on_destroy.push(()=>u()),re();let m=0,{messages:f=k(null)}=s;function g(){d(t(0,f=n&&de({conversationId:r},null,n.isNew)||f))}d();let h,p,v,I=!1,E=0;async function w(){h&&(await ee(),h&&h.scrollTo(0,h.scrollHeight))}async function b(){h&&o&&o.length>m&&(h.scrollTop+h.offsetHeight>h.scrollHeight-M.MIN_AUTO_SCROLL_BOTTOM_DIST?(await ee(),h.scrollTo(0,h.scrollHeight)):t(1,I=!0)),m=o?o.length:0}let D,A,C,N,x,H,L=!1;return Q(()=>{L=!0,me.on("messagedAdded",w)}),oe(()=>{L=!1,me.off("messagedAdded",w)}),e.$set=(e=>{"messages"in e&&d(t(0,f=e.messages))}),e.$$.update=(()=>{16384&e.$$.dirty&&g(),98304&e.$$.dirty&&re(),32&e.$$.dirty&&b(),524320&e.$$.dirty&&t(18,D=c&&!o),2244608&e.$$.dirty&&t(20,A=i&&(!n||n.id!==r)),1310848&e.$$.dirty&&t(6,C=(D||A)&&!$),49344&e.$$.dirty&&t(8,N=!C&&a&&(n||$)),16384&e.$$.dirty&&t(22,x=n&&n.isGroup||!1),4194304&e.$$.dirty&&(H=x?"messages_group_view":"message_view"),4120&e.$$.dirty&&(p&&v<M.MOBILE_DEVICE_MAX_WIDTH&&p<E&&(w(),(async()=>{await ee(),w()})()),t(12,E=p))}),[f,I,h,p,v,o,C,$,N,w,function(){I&&h.scrollTop+h.offsetHeight>h.scrollHeight-M.MIN_HIDE_MESSAGES_BOTTOM_DIST&&t(1,I=!1)},m,E,L,n,a,l,r,D,c,A,i,x,H,g,b,function(){t(3,p=window.innerHeight),t(4,v=window.innerWidth)},function(e){t(2,h=e)}]}export default class extends e{constructor(e){super(),s(this,e,Xe,Ue,t,{messages:0})}}
